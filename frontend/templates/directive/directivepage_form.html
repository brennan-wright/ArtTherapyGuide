{% extends "base.html" %}
{% load crispy_forms_tags wagtailcore_tags %}


{% block head_title %}
{% if page %}
Edit {{ page.title}}
{% else %}
New Directive Listing
{% endif %}

{% endblock %}

{% block extra_head %}
{{ form.media }}
{% endblock extra_head %}

{% block content %}
<div class="container">
    {% if page %}
    <h1 class="my-4">Edit: {{ page.title }}</h1>
    {% else %}
    <h1 class="my-4">Create New Directive Listing</h1>

    {% endif %}

    <div class="container shadow p-4 mb-4">
        {{ submit_info | richtext }}

        <form method="post" id="directiveForm" name="directiveform" enctype="multipart/form-data"
            data-cities-url="{% url 'ajax_load_cities' %}">
            {% csrf_token %}
            <table>
                {{ form.as_p }}
                {{ image_form.as_p }}
            </table>
            <div class="row justify-content-between">
                <div class="col">
                    <input type="submit" class="btn btn-primary" value="Submit">
                    {% if page %}
                    <a class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this?')"
                        href="{% url 'delete_directive_entry' uuid=page.uuid %}">Delete</a>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
    {% endblock %}

    {% block extra_script %}

    <script>
        var MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB

        $(document).ready(function () {
            $('#id_directiveimages_set-0-image, #id_directiveimages_set-1-image, #id_directiveimages_set-2-image')
                .change(function () {
                    fileSize = this.files[0].size;
                    if (fileSize > MAX_FILE_SIZE) {
                        this.setCustomValidity("File must not exceed 10 MB!");
                        this.reportValidity();
                    } else {
                        this.setCustomValidity("");
                    }
                });
        });
    </script>
    {% endblock extra_script %}