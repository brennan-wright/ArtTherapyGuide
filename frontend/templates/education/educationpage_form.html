{% extends "base.html" %}
{% load crispy_forms_tags wagtailcore_tags %}


{% block head_title %}
{% if page %}
Edit {{ page.school_name}}
{% else %}
New Education Listing
{% endif %}

{% endblock %}

{% block extra_head %}
{{ form.media }}
{% endblock extra_head %}

{% block content %}
<div class="container">
    {% if page %}
    <h1 class="my-4">Edit: {{ page.degree_offered }}</h1>
    {% else %}
    <h1 class="my-4">Create New Education Listing</h1>

    {% endif %}

    <div class="container shadow p-4 mb-4">
        {{ submit_info | richtext }}

        <form method="post" id="educationForm" data-cities-url="{% url 'ajax_load_cities' %}" novalidate>
            {% csrf_token %}
            <table>
                {{ form.as_p }}
            </table>
            <div class="row justify-content-between">
                <div class="col">
                    <input type="submit" class="btn btn-primary" value="Submit">
                    {% if page %}
                    <a class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this?')"
                        href="{% url 'delete_education_entry' uuid=page.uuid %}">Delete</a>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
    {% endblock %}

    {% block extra_script %}

    <script>
        $("#id_region").change(function () {
            var url = $("#educationForm").attr("data-cities-url"); // get the url of the `load_cities` view
            var regionId = $(this).val(); // get the selected country ID from the HTML input

            $.ajax({ // initialize an AJAX request
                url: url, // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
                data: {
                    'region': regionId // add the country id to the GET parameters
                },
                success: function (data) { // `data` is the return of the `load_cities` view function
                    $("#id_city").html(
                        data
                    ); // replace the contents of the city input with the data that came from the server
                }
            });
        });
    </script>

    {% endblock extra_script %}